<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<title>CHAPI is the Credential Handler API | an open-source solution for communicating Verifiable Credentials on the Web</title>
<meta property="og:title" content="CHAPI is the Credential Handler API" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="an open-source solution for communicating Verifiable Credentials on the Web" />
<meta property="og:description" content="an open-source solution for communicating Verifiable Credentials on the Web" />
<link rel="canonical" href="https://chapi.io/" />
<meta property="og:url" content="https://chapi.io/" />
<meta property="og:site_name" content="CHAPI is the Credential Handler API" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CHAPI is the Credential Handler API" />
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","description":"an open-source solution for communicating Verifiable Credentials on the Web","headline":"CHAPI is the Credential Handler API","name":"CHAPI is the Credential Handler API","url":"https://chapi.io/"}</script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.2/dist/semantic.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <!-- Sidebar Menu -->
    <div class="ui vertical inverted right sidebar menu">
      <a class="item" href="/developers/issuers">VC Issuers</a>
      <a class="item" href="/developers/wallets">Digital Wallets</a>
      <a class="item" href="/developers/verifiers">VC Verifiers</a>
      <span class="item">
        <a class="ui basic inverted button" href="https://playground.chapi.io/">Try the Playground!</a>
      </span>
    </div>

    <div class="pusher">
    <header class="ui top inverted fixed menu" role="banner">
      <a class="ui header item" href=https://chapi.io/>
        chapi.io
        <span class="desktop only">&nbsp; | Credential Handler API</span>
      </a>
      <span class="item">
        <a class="ui basic inverted button" href="https://playground.chapi.io/">Try the Playground!</a>
      </span>
      <div class="right menu">
        <a class="toc icon item"><i class="sidebar icon"></i></a>
        <a class="item" href="/developers/issuers">VC Issuers</a>
        <a class="item" href="/developers/wallets">Digital Wallets</a>
        <a class="item" href="/developers/verifiers">VC Verifiers</a>
      </div>
    </header>
    

    <main id="content" class="main-content" role="main">
      <h1>CHAPI for Digital Wallets</h1>
<p>CHAPI integrates easily into digital wallet software, allowing your wallet to receive and present Verifiable Credentials to/from third party sites.</p>
<ul>
<li><a href="#for-web-wallets">for Web Wallets</a></li>
<li><a href="#for-native-mobile-apps">for Native Mobile Wallets</a></li>
<li><a href="querybyexample">Working with <code>QueryByExample</code> format requests</a></li>
</ul>
<h2>for Web Wallets</h2>
<h3>Resources</h3>
<ul>
<li><strong>Example Code</strong>: the <a href="https://github.com/credential-handler/chapi-demo-wallet">chapi-demo-wallet</a> contains a full example implementation and is referenced throughout this guide.</li>
<li><strong>Polyfill Library</strong>: The <a href="https://github.com/credential-handler/credential-handler-polyfill">credential-handler-polyfill</a> library provides the needed functionality in the browser.</li>
<li><strong>Helper Library</strong>: The <a href="https://github.com/credential-handler/web-credential-handler">web-credential-handler</a> library provides helper functions for CHAPI integration in your code.</li>
</ul>
<h3>First, set up your wallet to register itself with the browser as a Credential Handler.</h3>
<h4>1. Import the CHAPI Polyfill into your wallet app</h4>
<p>If you're developing on Node.js, add the credential-handler-polyfill library to your project.  You can also install the web-credential-handler helper library to simplify your code.</p>
<pre><code class="language-sh">npm i credential-handler-polyfill@3
npm i web-credential-handler@2
</code></pre>
<p>In your code, you can import and load the polyfill library as follows:</p>
<pre><code class="language-javascript">import * as CredentialHandlerPolyfill from 'credential-handler-polyfill';
import * as WebCredentialHandler from 'web-credential-handler';

await CredentialHandlerPolyfill.loadOnce();
console.log('Ready to work with credentials!');
</code></pre>
<p class="code-annotation">
  <a href="https://github.com/credential-handler/chapi-demo-wallet/blob/master/install-wallet.js"
  target="_blank" rel="noopener noreferrer"> chapi-demo-wallet/install-wallet.js </a>
</p>
<h4>2. Add a <code>credential_handler</code> to your app's manifest.json</h4>
<p>In order to register a credential handler, your web app must serve a &quot;manifest.json&quot; file from its root path (&quot;/manifest.json&quot;). This file must also be CORS-enabled.  At a minimum, add the following <code>credential_handler</code> object:</p>
<pre><code class="language-json">{
  &quot;credential_handler&quot;: {
    &quot;url&quot;: &quot;/wallet-worker.html&quot;,
    &quot;enabledTypes&quot;: [&quot;VerifiablePresentation&quot;]
  }
}
</code></pre>
<p class="code-annotation">
  <a href="https://github.com/credential-handler/chapi-demo-wallet/blob/master/manifest.json"
  target="_blank" rel="noopener noreferrer"> chapi-demo-wallet/manifest.json </a>
</p>
<h4>3. Allow your users to register their wallet's credential handler with the browser polyfill</h4>
<p>You can register a Credential Handler by calling the <code>CredentialManager.requestPermission()</code> API. This call will ensure that the individual using the browser explicitly confirms that they want to use the website as a credential handler. The example below uses the <code>installHandler()</code> helper method to perform this action:</p>
<pre><code class="language-javascript">  await WebCredentialHandler.installHandler();
  console.log('Wallet installed.');
</code></pre>
<p class="code-annotation">
  <a href="https://github.com/credential-handler/chapi-demo-wallet/blob/master/install-wallet.js"
  target="_blank" rel="noopener noreferrer"> chapi-demo-wallet/install-wallet.js </a>
</p>
<h3>Then, configure your wallet to respond to Credential Handler events.</h3>
<p>Your wallet app's existing functionality can be configured to respond to CHAPI events.</p>
<h4>4. Setup Listeners for CHAPI Events</h4>
<p>The <code>activateHandler()</code> function is a helper that sets up listeners for CHAPI <code>get()</code> and <code>store()</code> events.</p>
<pre><code class="language-javascript">WebCredentialHandler.activateHandler({
    async get(event) {
        console.log('WCH: Received get() event:', event);
        return { type: 'redirect', url: '/wallet-ui-get.html' };
    },
    async store(event) {
        console.log('WCH: Received store() event:', event);
        return { type: 'redirect', url: '/wallet-ui-store.html' };
    }
})
</code></pre>
<p class="code-annotation">
  <a href="https://github.com/credential-handler/chapi-demo-wallet/blob/master/wallet-worker.html"
  target="_blank" rel="noopener noreferrer"> chapi-demo-wallet/wallet-worker.html </a>
</p>
<h4>5. Get Credentials Events</h4>
<p>CHAPI supports the presentation of credentials via the <code>navigator.credentials.get()</code> API. CHAPI is agnostic to the presentation request query language and passes the query directly through to the credential handler. If you've configured an event listener, you can follow the example below to call the relevant code in your wallet whenever it receives a CHAPI <code>get()</code> request from a third-party website.</p>
<pre><code class="language-javascript">  async function handleGetEvent() {
    const event = await WebCredentialHandler.receiveCredentialEvent();

    console.log('Wallet processing get() event:', event);

    //Your wallet's code for responding to a request for a Verifiable Credential
  }

</code></pre>
<p class="code-annotation">
  <a href="https://github.com/credential-handler/chapi-demo-wallet/blob/master/wallet-ui-get.html"
  target="_blank" rel="noopener noreferrer"> chapi-demo-wallet/wallet-ui-get.html </a>
</p>
<p>When presenting credentials, the user is shown what they will be sharing and must provide explicit consent before the credentials are shared with the requesting party.</p>
<h4>6. Store Credentials Events</h4>
<p>CHAPI supports storing credentials via the <code>navigator.credentials.store()</code> API. If you've configured an event listener, you can follow the example below to call the relevant code in your wallet whenever it receives a CHAPI <code>store()</code> request from a third-party website.</p>
<pre><code class="language-javascript">async function handleStoreEvent() {
    const event = await WebCredentialHandler.receiveCredentialEvent();
    console.log('Store Credential Event:', event.type, event);

    //Your wallet's code for storing a Verifiable Credential
}
</code></pre>
<p class="code-annotation">
  <a href="https://github.com/credential-handler/chapi-demo-wallet/blob/master/wallet-ui-store.html"
  target="_blank" rel="noopener noreferrer"> chapi-demo-wallet/wallet-ui-store.html </a>
</p>
<p>Storage of credentials prompts the individual using the browser to confirm that they want to store the credential in their digital wallet.</p>
<h2>DID Authentication with CHAPI</h2>
<p>This section is written from the perspective of web wallets.  CHAPI provides a simple method for a 3rd party website to request an individual present their Decentralized Identifier (DID) and prove their identity.  The individual selects a digital wallet to respond to this DID Authentication request.</p>
<h3>Resources</h3>
<ul>
<li><a href="https://w3c-ccg.github.io/vp-request-spec/#did-authentication">Verifiable Presentation Request</a></li>
<li><a href="https://www.w3.org/TR/vc-data-model/#presentations">Verifiable Credentials Data Model</a></li>
<li><a href="https://www.w3.org/TR/did-core/#authentication">DID Core Specification</a></li>
</ul>
<h4>1. The 3rd Party Site sends a DID Authentication Request</h4>
<p>The individual interacts with a 3rd party website, triggering a request for <em>DID Authentication</em>.  The site sends a <em>Verifiable Presentation Request</em> (VPR) using the CHAPI <code>get()</code> event.</p>
<p>An example VPR is shown below.  Like the other CHAPI examples on this site, the VPR is wrapped in a <code>web</code> credential object - this ensures that it is passed to a <em>Credential Handler</em> in the individual's browser.</p>
<pre><code>&quot;web&quot;: {
  &quot;VerifiablePresentation&quot;: {
      &quot;query&quot;: {
        &quot;type&quot;: &quot;DIDAuthentication&quot;
      },
      &quot;challenge&quot;: &quot;IME0WNG2MIOsYsPgezxAM&quot;, //randomly-generated challenge string (e.g.,a UUID, nanoid, or bnid)
      &quot;domain&quot;: &quot;https://playground.chapi.io&quot; //URL of your web app (where the wallet will respond to the DID Auth request
  },
  &quot;recommendedHandlerOrigins&quot;: [
      &quot;https://demo.vereswallet.dev/&quot;
  ]
}
</code></pre>
<h4>2. The Digital Wallet responds with a Verifiable Presentation</h4>
<p>The individual selects a digital wallet, which responds to the CHAPI <code>get()</code> event.  The example code below shows two functions, plus a third function that your wallet will need to create</p>
<ul>
<li><code>handleGetEvent()</code> responds to the CHAPI <code>get()</code> event and calls <code>formDIDAuthResponse()</code> if it sees a request for DID Authentication.</li>
<li><code>formDIDAuthResponse()</code> creates a &quot;web&quot; credential containing a signed Verifiable Presentation meeting the VPR Spec for DID Authentication</li>
<li><code>signDidAuthPresentation()</code> is the lower-level function in your wallet that creates a signed Verifiable Presentation with the user's DID.</li>
</ul>
<pre><code class="language-javascript">async function formDidAuthResponse({challenge, domain}) {
    const dataType = 'VerifiablePresentation';

    //Add your code for signing a verifiable presentation
    didAuthPresentation = await signDidAuthPresentation({challenge, domain});

    //wrap the DID Auth presentation in a web credential
    const credentialType = 'VerifiablePresentation';
    const didAuthResponse = new WebCredential(
      credentialType, didAuthPresentation, {
      recommendedHandlerOrigins: []
    });

    return didAuthResponse;
}

async function handleGetEvent() {
    const event = await WebCredentialHandler.receiveCredentialEvent();
    console.log('Get Credential Event:', event.type, event);

    const vp = event.credentialRequestOptions.web.VerifiablePresentation;
    const query = Array.isArray(vp.query) ? vp.query[0] : vp.query;

    const {type} = query.value;
    if(type ==='DIDAuthentication') {
      event.respondWith(formDidAuthResponse({challenge: vp.challenge, domain: vp.domain}))
    }
}
</code></pre>
<p>Your wallet's version of <code>signDidAuthPresentation()</code> should create a signed Verifiable Presentation with the <code>holder</code> equal to the user's DID.  The example below shows what this looks like with the Ed25519Signature2020 and 2018 signature suites, respectively.</p>
<pre><code class="language-javascript">const didAuthPresentation = {
    '@context': [
        'https://www.w3.org/2018/credentials/v1',
        'https://w3id.org/security/suites/ed25519-2020/v1'
    ],
    type: ['VerifiablePresentation'],
    holder: 'did:key:z6MkeprvBw4RFHJPQEmtioq4xRrN6Tk8EBSJ37eBCBQNHRjZ',
    proof: {
        type: 'Ed25519Signature2020',
        created: '2022-11-09T22:04:18Z',
        verificationMethod: 'did:key:z6MkeprvBw4RFHJPQEmtioq4xRrN6Tk8EBSJ37eBCBQNHRjZ#z6MkeprvBw4RFHJPQEmtioq4xRrN6Tk8EBSJ37eBCBQNHRjZ',
        proofPurpose: 'authentication',
        challenge: 'qd4_rg4FvyYDUIuy-DmN9',
        domain: 'https://localhost:51443',
        proofValue: 'zinUxNo4eLvMRU7QaYwSKTKRkvYud7cDeh3B8zm3G1FLZGiSKjCXFgZiQTLKJmpLuatgpcqCTpRZBj4ETAsddcfe'
    }
};

</code></pre>
<pre><code class="language-javascript">const didAuthPresentation = {
    &quot;@context&quot;: [
        &quot;https://www.w3.org/2018/credentials/v1&quot;,
    ],
    &quot;type&quot;: &quot;VerifiablePresentation&quot;,
    &quot;holder&quot;: &quot;did:v1:test:nym:z6MkjsQSCqdN4CGE6R9tKhETAEoPYdXci5v4tK2USAhWptpr&quot;,
    &quot;proof&quot;: {
        &quot;type&quot;: &quot;Ed25519Signature2018&quot;,
        &quot;created&quot;: &quot;2022-10-28T20:24:27Z&quot;,
        &quot;verificationMethod&quot;: &quot;did:v1:test:nym:z6MkjsQSCqdN4CGE6R9tKhETAEoPYdXci5v4tK2USAhWptpr#z6MkjsQSCqdN4CGE6R9tKhETAEoPYdXci5v4tK2USAhWptpr&quot;,
        &quot;proofPurpose&quot;: &quot;authentication&quot;,
        &quot;challenge&quot;: &quot;IME0WNG2MIOsYsPgezxAM&quot;,
        &quot;domain&quot;: &quot;https://playground.chapi.io&quot;,
        &quot;jws&quot;: &quot;eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..n7f3DZ4yNuH2ApE0dZy1gaLBTKEuGYHGsmycgWwKptZaNeKz2FKRAjzPeat3GQnJg1n_5Q6GU9bAql602m2tCg&quot;
    }
};
</code></pre>
<h2>for Native Mobile Apps</h2>
<h3>Resources</h3>
<ul>
<li>WebShare Specification: <a href="https://w3c.github.io/web-share/">this W3C draft</a> describes the Web Share API.</li>
<li>WebShare Documentation: <a href="https://web.dev/web-share/">web.dev</a> hosts developer docs and examples for the WebShare API</li>
</ul>
<p>To enable a native wallet to receive VCs via CHAPI, you’ll need to register the wallet as a share target with the mobile OS that is capable of receiving text files.  See appropriate share target documentation for <a href="https://developer.android.com/training/sharing/receive">Android</a> or <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionScenarios.html#//apple_ref/doc/uid/TP40014214-CH21-SW1">iOS</a>.</p>


      <footer class="site-footer">
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.2/dist/semantic.min.js"></script>
    <script>
      // create sidebar and attach to menu open
      $('.ui.sidebar')
        .sidebar('attach events', '.toc.item');
    </script>

  </body>
</html>
