<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<title>CHAPI is the Credential Handler API | an open-source solution for communicating Verifiable Credentials on the Web</title>
<meta property="og:title" content="CHAPI is the Credential Handler API" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="an open-source solution for communicating Verifiable Credentials on the Web" />
<meta property="og:description" content="an open-source solution for communicating Verifiable Credentials on the Web" />
<link rel="canonical" href="https://chapi.io/" />
<meta property="og:url" content="https://chapi.io/" />
<meta property="og:site_name" content="CHAPI is the Credential Handler API" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CHAPI is the Credential Handler API" />
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","description":"an open-source solution for communicating Verifiable Credentials on the Web","headline":"CHAPI is the Credential Handler API","name":"CHAPI is the Credential Handler API","url":"https://chapi.io/"}</script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/prismjs@1/themes/prism.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.2/dist/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <!-- Sidebar Menu -->
    <div class="ui vertical inverted right sidebar menu">
      <a class="item" href="/developers/issuers">VC Issuers</a>
      <a class="item" href="/developers/wallets">Digital Wallets</a>
      <a class="item" href="/developers/verifiers">VC Verifiers</a>
      <span class="item">
        <a class="ui basic inverted button" href="https://vcplayground.org/">Try the Playground!</a>
      </span>
    </div>

    <div class="pusher">
    <header class="ui top inverted fixed menu" role="banner">
      <a class="ui header item" href=https://chapi.io/>
        chapi.io
        <span class="desktop only">&nbsp; | Credential Handler API</span>
      </a>
      <span class="item">
        <a class="ui basic inverted button" href="https://vcplayground.org/">Try the Playground!</a>
      </span>
      <div class="right menu">
        <a class="toc icon item"><i class="sidebar icon"></i></a>
        <a class="item" href="/developers/issuers">VC Issuers</a>
        <a class="item" href="/developers/wallets">Digital Wallets</a>
        <a class="item" href="/developers/verifiers">VC Verifiers</a>
      </div>
    </header>
    

    <main id="content" class="main-content" role="main">
      <h1 id="developer-docs-for-chapi-wallet-querybyexample" tabindex="-1">Developer Docs for CHAPI Wallet QueryByExample</h1>
<p>Prerequisite: This document assumes completion of the
<a href="./">CHAPI integration for Digital Wallets integration instructions</a>.</p>
<p>Responding to requests for credentials from a verifier is a critical step in building out a complete wallet. There are multiple credential query formats, but today we're focusing on Verifiable Presentation Request's <code>QueryByExample</code> format.</p>
<p>When integrating with the CHAPI Playground, the JSON sent to the Wallet is in the form of a Verifiable Presentation (VP) Request with one or more QueryByExamples. The payload will be received from the <code>handleGetEvent</code> function:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleGetEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">await</span> WebCredentialHandler<span class="token punctuation">.</span><span class="token function">receiveCredentialEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Get Credential Event:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>type<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vpr <span class="token operator">=</span> event<span class="token punctuation">.</span>credentialRequestOptions<span class="token punctuation">.</span>web<span class="token punctuation">.</span>VerifiablePresentation<span class="token punctuation">;</span>
  <span class="token comment">// Contains one more QueryByExamples</span>
  <span class="token keyword">const</span> query <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vpr<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token operator">?</span> vpr<span class="token punctuation">.</span>query<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> vpr<span class="token punctuation">.</span>query<span class="token punctuation">;</span>

  <span class="token comment">// Your wallet's code for responding to a request for a Verifiable Credential</span>
<span class="token punctuation">}</span></code></pre>
<p>A QueryByExample contains a property named <code>credentialQuery.example</code> which contains the set of properties that the Verifiable Credential (VC) must match. The <code>@context</code> and <code>type</code> properties of a VC will always be present. Additional properties may be requested for more fine grained querying. Use the QueryByExample(s) in combination with the credentials in your wallet to query for the proper VCs.</p>
<p>Next, you will create a signed Verifiable Presentation (VP) using the requested VCs.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">formSignedVPResponse</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>challenge<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> verifiableCredentials<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Add your code for signing a verifiable presentation</span>
  <span class="token keyword">const</span> vp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">signVerifiablePresentation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>challenge<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> verifiableCredentials<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Wrap the verifiable presentation in a web credential</span>
  <span class="token keyword">const</span> credentialType <span class="token operator">=</span> <span class="token string">'VerifiablePresentation'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vpResponse <span class="token operator">=</span> <span class="token function">createWebCredential</span><span class="token punctuation">(</span>credentialType<span class="token punctuation">,</span> verifablePresentation<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> vpResponse<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Finally, you will wrap the signed VP in a WebCredential and send the response.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleGetEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">await</span> WebCredentialHandler<span class="token punctuation">.</span><span class="token function">receiveCredentialEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Get Credential Event:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>type<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vpr <span class="token operator">=</span> event<span class="token punctuation">.</span>credentialRequestOptions<span class="token punctuation">.</span>web<span class="token punctuation">.</span>VerifiablePresentation<span class="token punctuation">;</span>
  <span class="token comment">// Contains one more QueryByExamples</span>
  <span class="token keyword">const</span> query <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vpr<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token operator">?</span> vpr<span class="token punctuation">.</span>query<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> vpr<span class="token punctuation">.</span>query<span class="token punctuation">;</span>

  <span class="token comment">// Your wallet's code for responding to a request for a Verifiable Credential</span>
  <span class="token keyword">const</span> requestedVCs <span class="token operator">=</span> <span class="token function">getVerifiableCredentials</span><span class="token punctuation">(</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    <span class="token function">formSignedVPResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">challenge</span><span class="token operator">:</span> vpr<span class="token punctuation">.</span>challenge<span class="token punctuation">,</span>
      <span class="token literal-property property">domain</span><span class="token operator">:</span> vpr<span class="token punctuation">.</span>domain<span class="token punctuation">,</span>
      <span class="token literal-property property">verifiableCredentials</span><span class="token operator">:</span> requestedVCs
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Below you will find the VP Requests which Wallets may receive when testing used with the <a href="https://vcplayground.org/">CHAPI Playground</a>.</p>
<h2 id="vp-request-for-alumni-vc" tabindex="-1">VP Request for Alumni VC</h2>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"QueryByExample"</span><span class="token punctuation">,</span>
      <span class="token property">"credentialQuery"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"Please present your Verifiable Credential to complete the verification process."</span><span class="token punctuation">,</span>
        <span class="token property">"example"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://www.w3.org/2018/credentials/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://www.w3.org/2018/credentials/examples/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://contexts.vcplayground.org/examples/alumni/v1.json"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"AlumniCredential"</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="vp-request-for-jff-x-vc-edu-pf3-vc" tabindex="-1">VP Request for JFF x vc-edu PF3 VC</h2>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"QueryByExample"</span><span class="token punctuation">,</span>
      <span class="token property">"credentialQuery"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"Please present your Verifiable Credential to complete the verification process."</span><span class="token punctuation">,</span>
        <span class="token property">"example"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://www.w3.org/2018/credentials/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://purl.imsglobal.org/spec/ob/v3p0/context.json"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"OpenBadgeCredential"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"credentialSubject"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"achievement"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"urn:uuid:ac254bd5-8fad-4bb1-9d29-efd938536926"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="vp-request-for-permanent-resident-vc" tabindex="-1">VP Request for Permanent Resident VC</h2>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"QueryByExample"</span><span class="token punctuation">,</span>
      <span class="token property">"credentialQuery"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"Please present your Verifiable Credential to complete the verification process."</span><span class="token punctuation">,</span>
        <span class="token property">"example"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://www.w3.org/2018/credentials/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://w3id.org/citizenship/v1"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"PermanentResidentCard"</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="vp-request-for-alumni-%26-jff-x-vc-edu-pf3-%26-permanent-resident-vc" tabindex="-1">VP Request for Alumni &amp; JFF x vc-edu PF3 &amp; Permanent Resident VC</h2>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"QueryByExample"</span><span class="token punctuation">,</span>
      <span class="token property">"credentialQuery"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"Please present your Verifiable Credential to complete the verification process."</span><span class="token punctuation">,</span>
        <span class="token property">"example"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://www.w3.org/2018/credentials/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://www.w3.org/2018/credentials/examples/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://contexts.vcplayground.org/examples/alumni/v1.json"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"AlumniCredential"</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"QueryByExample"</span><span class="token punctuation">,</span>
      <span class="token property">"credentialQuery"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"Please present your Verifiable Credential to complete the verification process."</span><span class="token punctuation">,</span>
        <span class="token property">"example"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://www.w3.org/2018/credentials/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://w3id.org/citizenship/v1"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"PermanentResidentCard"</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"QueryByExample"</span><span class="token punctuation">,</span>
      <span class="token property">"credentialQuery"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"Please present your Verifiable Credential to complete the verification process."</span><span class="token punctuation">,</span>
        <span class="token property">"example"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://www.w3.org/2018/credentials/v1"</span><span class="token punctuation">,</span>
            <span class="token string">"https://purl.imsglobal.org/spec/ob/v3p0/context.json"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"OpenBadgeCredential"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"credentialSubject"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"achievement"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"urn:uuid:ac254bd5-8fad-4bb1-9d29-efd938536926"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>


      <footer class="site-footer">
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.2/dist/semantic.min.js"></script>
    <script>
      // create sidebar and attach to menu open
      $('.ui.sidebar')
        .sidebar('attach events', '.toc.item');
    </script>
    <script src="/assets/js/tabs.js"></script>

  </body>
</html>
